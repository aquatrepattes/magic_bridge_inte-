$(function(){function e(){addthis.toolbox(".addthis_toolbox")}var t=$(window).outerWidth(),n=$(window).outerHeight(),r=function(){$("[role='marquee'],[role='marquee'] .panel").css({height:$(window).outerHeight()+"px"});var e=$("[role='marquee'] .panel .wrapper").each(function(e){var t=$(this).outerHeight(),r=n/2-t/2+22;$(this).css({"margin-top":r+"px"})})},s=function(){$(window).resize(function(e){t=$(window).outerWidth();n=$(window).outerHeight();r()})},o=function(e,t){$("html, body").animate({scrollTop:e},{duration:t,queue:!1})},u=function(){$(window).scroll(function(){var e=$(".ui nav"),t=$(document).scrollTop()+20+"px";$.device.type!=="mobile"&&e.animate({top:t},{duration:260,queue:!1})});$(".menu").on("click",this,function(e){$(this).toggleClass("on")});$(".menu li a, a.scroller").on("click",this,function(e){e.preventDefault();var t=$(this).attr("href");o($(t).offset().top-22,460)})},a=function(e,t,n,r){var i=new TimelineLite;i.fromTo($(e),.3,{autoAlpha:t},{autoAlpha:n,delay:.2,ease:"Quad.easeInOut",onComplete:r})},f=function(){var e=$(".toggler").addClass("off").css({opacity:0});$(".toggle").not(".switch").find("a").click(function(e){e.preventDefault();$(this).toggleClass("on");o($(this).offset().top-22,230);var t=$("html, body").find("[data-toggler='"+$(this).attr("data-target")+"']").toggleClass("on"),n=function(){};if($(this).hasClass("on")){$(t).removeClass("off");a(t,"0","1",n)}else{n=function(){$(t).addClass("off")};a(t,"1","0",n)}})},l=function(){function t(t,n){var r=$("table[data-target="+n+"]");r.find("td span").css({display:"none"});var i=r.find("td span:nth-child(2n+"+t+")").css({display:"block"});a(i,"0","1",null);e.find("a:eq("+t+")").addClass("on")}var e=$("ul.toggle.switch");e.on("click","li",function(n){n.preventDefault();o($(this).offset().top-22,230);var r=$(this).index(),i=$(this).parent().attr("data-target");e.find("a").removeClass("on");t(r,i)});var n=$("table[data-target]").attr("data-target");t(1,n)},c={defaults:{},init:function(e){this.config=$.extend({},this.defaults,e);var t=this,n=$("#"+this.config.wrapper),r=n.find(".swipe"),i=n.find(".carousel"),s=n.find(".carousel nav"),o=r.Swipe({speed:460,stopPropagation:!1,callback:function(e,r){t.setPagination(n,o)}}).data("Swipe");t.buildNav(s,o);t.activateNav(s,o);t.setPagination(n,o)},activateNav:function(e,t){e.on("click","a",function(e){e.preventDefault();var n=$(this).attr("data-action");switch(n){case"prev":t.prev();break;case"next":t.next();break;default:t.slide(n-1,460)}})},buildNav:function(e,t){var n=t.getNumSlides(),r=$("<div class='pagination' id='"+this.config.wrapper+"_nav"+"'><ol></ol></div>");if(n>2){for(i=1;i<=n;i++)r.find("ol").append("<li><a href='#"+i+"'  data-action='"+i+"'>"+i+"</a></li>");e.append(r)}},setPagination:function(e,t){e.find("#"+e.attr("id")+"_nav li").removeClass("active");e.find("#"+e.attr("id")+"_nav li:eq("+t.getPos()+")").addClass("active")}},h={defaults:{FRAGMENT_DIR:"",$target:$("#target"),$items:$("a.page")},init:function(e){this.config=$.extend({},this.defaults,e);var t=this;t.config.$master=$(this.config.mainPageWrapper);t.config.$items.on("click",this,function(e){if($.device.type!="mobile"&$(this).attr("data-app")=="ajax"){e.preventDefault();e.stopPropagation();h.labels($(this));h.open($(this))}});t.config.$target.on("click",".ui a",function(e){e.preventDefault();var t=$(this).attr("data-action");switch(t){case"close":h.close($(".page.on"));break;default:h.browse($(".page.on"),t)}})},labels:function(e){var t=$(e).parent();$("#target .ui .label > span").remove();$("#target .ui .label:not(:eq(0))").append(" <span>"+t.attr("data-label")+"</span>")},browse:function(e,n){var r=this,i=r.config.$target.find(".content"),s=$(e).removeClass("on"),o=s.parent(),u=o.find("a.page").length,a=s.index();console.log(n);if(n=="next"){a+=1;n=-1*t}else{a-=1;n=1*t}a<=0&&(a=u);a>u&&(a=1);console.log(a+" / "+u);var f=o.find("a.page:eq("+(a-1)+")").addClass("on"),l=f.attr("href"),c=new TimelineLite;c.fromTo(i,.3,{autoAlpha:"1"},{autoAlpha:"0",x:n,delay:.2,ease:"Circ.easeInOut",onComplete:function(){setTimeout(function(){h.loadFragment(l)},250);c.set(i,{x:-n});c.kill()}})},close:function(e){var r=this,i=r.config.$target.removeClass("on"),u=i.find(".content").html(""),a=$(e);r.config.$master.removeClass("frozen");var f=a.offset();o(f.top,0);TweenLite.set(i,{y:f.top});var l=new TimelineLite;l.fromTo(u,.3,{autoAlpha:"1"},{autoAlpha:"0",delay:.2,ease:"Quad.easeInOut",onComplete:function(){u.html("")}});l.to(i,.5,{autoAlpha:"1",width:a.outerWidth(),height:a.outerHeight(),x:t/2-a.outerWidth()/2,y:f.top+(n/2-a.outerHeight()/2),ease:"Circ.easeInOut",delay:.2});l.to(i,.3,{x:f.left,y:f.top,ease:"Circ.easeInOut",delay:.5,onComplete:function(){o(f.top-22,0);TweenLite.set(i,{autoAlpha:"0"});a.removeClass("on");s();l.kill()}})},open:function(e){var r=this,i=r.config.$target,s=$(e).addClass("on"),u=s.offset(),a=s.attr("href");o(u.top-22,250);var f=new TimelineLite;f.set(i,{autoAlpha:"0",x:u.left,y:u.top,width:s.outerWidth(),height:s.outerHeight()});f.to(i,.4,{autoAlpha:"1",x:t/2-s.outerWidth()/2,y:u.top+(n/2-s.outerHeight()/2),ease:"Circ.easeInOut",delay:.2});f.to(i,.4,{autoAlpha:"1",width:t,height:n,x:0,y:u.top-22,ease:"Circ.easeInOut",onComplete:function(){r.config.$master.addClass("frozen");i.addClass("on");setTimeout(function(){h.loadFragment(a);f.kill()},500)}})},loadFragment:function(t){var n=this.config.FRAGMENT_DIR+t+"?nocache="+Math.floor(Math.random()*1e4+1),r=this.config.$target.find(".content").html(""),i=new TimelineLite;i.set(this.config.$target,{y:0});o(0,0);$.ajaxSetup({async:!1});$.ajax({url:n,dataType:"html",success:function(e){r.html($(e).find("#sub"));setTimeout(function(){c.init({wrapper:"sub"})},250)}});i.fromTo(r,.3,{autoAlpha:"0"},{autoAlpha:"1",x:0,delay:.3,ease:"Quad.easeInOut",onComplete:function(){f();l();e();$("#sub [class*='grid'] p a, #sub [class*='grid'] h2 a ").on("click",this,function(e){e.preventDefault();var t=$(this).attr("href");window.open(t,"_blank")});i.kill()}})}};r();s();u();if($("#sub").length>0){c.init({wrapper:"sub"});f();l();addthis.init()}else{c.init({wrapper:"accueil"});h.init({mainPageWrapper:"#master"})}});